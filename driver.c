/*
	Gyanendra Mishra 2013A7PS126P
	Prabhjyot Singh Sodhi 2013A7PS151P
	Filename:driver.c
*/

#include <stdio.h>
#include <string.h>
#include "parser.c"

void commentFreeCode(char * Filename){
	FILE * fp;
    char * line = NULL;
    size_t len = 0;
    ssize_t read;

    fp = fopen(Filename, "r");
    if(fp == NULL){
    	printf("Invalid source file\n");
    	exit(-1);
    }
    while((read = getLine(&line, &len, fp)) != -1){
    	int position_of_comment = -1;
    	int i = 0;
    	while(i!=read){
    		if(line[i] == '%'){
    			position_of_comment = i;
    			break;
    		}
    		i++;
    	}

    	if(position_of_comment == -1){
    		printf("%s\n", line);
    	}
    	else{
    		line[position_of_comment] = '\0';
    		printf("%s\n", line);
    	}
    }
}

void printAllTokens(char * Filename){
	FILE * fp;
	fp = fopen(Filename, "r");
	//buffer size ka scene
	buffersize k = 25;
	lineNo=1;
	state = 1;
	tokenInfo token = getNextToken(fp, b, k);
	while(strcmp(token.name, "ENDOFFILE")!=0){
		printf("%s\t%s\t%d\n",getCorrespodingToken(token.id),token.name,token.lineNo);
		state = 1;
		token = getNextToken(fp, b, k);
	}
	return 0;
}

int main(int argc, char const *argv[])
{
	if (arc < 3){
		printf("Insufficient arguments provided, run as follows ./compiler testcase1.txt outfile.txt");
		return 0;
	}

	printf("---------------------------------------------------\n");
	printf("Lexical and syntax analysis module implemented!\n")
	printf("---------------------------------------------------\n");
	while(1){
		printf("---------------------------------------------------\n");
		printf("Press a number to choose the corresponding option\n");
		printf("Press 1 to see comment free code\n");
		printf("Press 2 to see a list of tokens generated by the lexer");
		printf("Press 3 for parsing and verifying syntactic correctness of code\n");
		printf("Press 4 for creating the parse tree\n");
		printf("Press 5 to exit\n");
		printf("---------------------------------------------------\n");
		int choice;
		scanf("%d",&choice);
		switch(choice){
			case 1:
				commentFreeCode(argv[2]);
				break;
			case 2:
				printAllTokens(argv[2]);
				break;
			case 3:
				//parse table
				break;
			case 4:
				// parseTree();
				break;

		}
	}
	return 0;
}